## 关于 onmath_limsapp 的基本功能与 API 说明
[onmath limsapp](https://github.com/jamebluntcc/ONMATHLIMS) 是对最初由 python web 框架 [flask](http://flask.pocoo.org/) 写的 名为 [myflask](https://github.com/jamebluntcc/myflask) 的建库测序管理系统的扩展,由 python [django](https://www.djangoproject.com/) 框架搭建。样品信息单和项目编号仍由 myflask 生成。对于后续的各个流程的管理由 onmath limsapp 完成。

### 基本模块功能
onmath_limsapp 由以下基本模块构成:
- 项目总览
  - 可以通过点击客户名称进入客户的经费管理页面;
  - 总览页面允许管理员对项目的状态和备注进行标识;
 - 点击进入项目详情可以进入项目详情页面，可以查询项目的基本情况和计费总览与管理员的操作信息;
- 样品接收(样品送出)
 - 通过选择项目查看所选项目送样情况，可以下载当前项目送样结果与上传送样结果，允许删除数据和上传项目附件,对当行送样数据可以进行备注;
- 样品质检
 - 功能同上;
- 样品上机
 - 功能同上;
- 样品下机
 - 功能同上;
- 返回样品
 - 运行上传返样结果，然后根据上传的结果对送样结果样品所在地进行更新,允许对上传数据进行删除;

### 计费管理功能
计费管理系统目前支持开票信息,收款信息,成本信息功能。三个表格都同时支持数据的输入,删除,插入,查找和下载。同时会对每个表格的金额进行自动的计算;

### 全局搜索功能
在每一个功能模块的左导航上存在搜索功能,允许对项目编号,样品编号,物种进行全局搜索。

### 数据的导入说明
onmath_limsapp 导入规则的设计原则是: 保证在同一个项目下的 OMID 与 sample_id 必须具有唯一性。
- import_send_sample

将上传得到的送样结果导入到数据库，具体实现分为有无 OMID:
- 若上传结果存在 OMID 则首先在数据库中搜索当前项目是否上传数据中存在数据库中不存在的 OMID 当存在数据库中没有的 OMID 时报错。否则将存在相同的 OMID 数据标记删除后（可理解为更新OMID）将全部上传数据导入数据库。
- 如果不存在 OMID 则会自动分配生成 OMID。然后将全部数据导入到数据库。


- import_quality_check

导入规则基本同送样，具体实现也分为有无 OMID。

- 上传结果有 OMID 和送样基本一致，当上传结果没有 OMID 时会根据送样结果的 sample_id 去自动匹配 OMID 如果存在不存在的 sample_id 系统会提示不存在相应的 sample_id 而报错。然后再具体根据上传的 sample_id 去和当前项目下已经存在（如果存在的话）的 sample_id 对比
如果数据库中已经存在了当前 sample_id 则会标记删除后将全部上传数据导入到数据库。


- import_build_lib

过程见 quality_check。

- import_upmachine

导入规则基本同质检，具体实现也分为有无 OMID。

- 基本过程和 quality_check 一致，只是当上传数据存在所在地时系统会判断当前为第一次上传上机结果，然后直接将全部数据导入。否则将数据视为数据库已经存在的数据，先根据 sample_id 标记删除数据库已经存在的数据然后再将上传数据全部导入到数据库。这样的结果会让上机部分的所在地一直显示为第一次上传的结果。

- import_downmachine

导入规则基本同质检，具体实现也分为有无 OMID。

- import_return_sample

由于返样是针对于全部的项目所以当上传返样结果到数据库中时会立即更新送样结果的所在地。这个过程不依赖于具体项目，而是以 sample_id 为 key 进行的更新。
